// ChessGPT Frontend - Built 2026-01-24T12:07:29.833Z

"use strict";(()=>{var qs=Object.defineProperty;var Ds=(i,t,e)=>t in i?qs(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var A=(i,t,e)=>Ds(i,typeof t!="symbol"?t+"":t,e);function Us(i){return i!==null?{comment:i,variations:[]}:{variations:[]}}function Gs(i,t,e,s,r){let o={move:i,variations:r};return t&&(o.suffix=t),e&&(o.nag=e),s!==null&&(o.comment=s),o}function Hs(...i){let[t,...e]=i,s=t;for(let r of e)r!==null&&(s.variations=[r,...r.variations],r.variations=[],s=r);return t}function Qs(i,t){if(t.marker&&t.marker.comment){let e=t.root;for(;;){let s=e.variations[0];if(!s){e.comment=t.marker.comment;break}e=s}}return{headers:i,root:t.root,result:(t.marker&&t.marker.result)??void 0}}function js(i,t){function e(){this.constructor=i}e.prototype=t.prototype,i.prototype=new e}function ee(i,t,e,s){var r=Error.call(this,i);return Object.setPrototypeOf&&Object.setPrototypeOf(r,ee.prototype),r.expected=t,r.found=e,r.location=s,r.name="SyntaxError",r}js(ee,Error);function Ne(i,t,e){return e=e||" ",i.length>t?i:(t-=i.length,e+=e.repeat(t),i+e.slice(0,t))}ee.prototype.format=function(i){var t="Error: "+this.message;if(this.location){var e=null,s;for(s=0;s<i.length;s++)if(i[s].source===this.location.source){e=i[s].text.split(/\r\n|\n|\r/g);break}var r=this.location.start,o=this.location.source&&typeof this.location.source.offset=="function"?this.location.source.offset(r):r,a=this.location.source+":"+o.line+":"+o.column;if(e){var h=this.location.end,u=Ne("",o.line.toString().length," "),p=e[r.line-1],m=r.line===h.line?h.column:p.length+1,w=m-r.column||1;t+=`
 --> `+a+`
`+u+` |
`+o.line+" | "+p+`
`+u+" | "+Ne("",r.column-1," ")+Ne("",w,"^")}else t+=`
 at `+a}return t};ee.buildMessage=function(i,t){var e={literal:function(p){return'"'+r(p.text)+'"'},class:function(p){var m=p.parts.map(function(w){return Array.isArray(w)?o(w[0])+"-"+o(w[1]):o(w)});return"["+(p.inverted?"^":"")+m.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(p){return p.description}};function s(p){return p.charCodeAt(0).toString(16).toUpperCase()}function r(p){return p.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(m){return"\\x0"+s(m)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(m){return"\\x"+s(m)})}function o(p){return p.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(m){return"\\x0"+s(m)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(m){return"\\x"+s(m)})}function a(p){return e[p.type](p)}function h(p){var m=p.map(a),w,g;if(m.sort(),m.length>0){for(w=1,g=1;w<m.length;w++)m[w-1]!==m[w]&&(m[g]=m[w],g++);m.length=g}switch(m.length){case 1:return m[0];case 2:return m[0]+" or "+m[1];default:return m.slice(0,-1).join(", ")+", or "+m[m.length-1]}}function u(p){return p?'"'+r(p)+'"':"end of input"}return"Expected "+h(i)+" but "+u(t)+" found."};function Ws(i,t){t=t!==void 0?t:{};var e={},s=t.grammarSource,r={pgn:ft},o=ft,a="[",h='"',u="]",p=".",m="O-O-O",w="O-O",g="0-0-0",E="0-0",C="$",T="{",D="}",Ae=";",Te="(",Rt=")",He="1-0",Qe="0-1",je="1/2-1/2",Ft="*",$e=/^[a-zA-Z]/,We=/^[^"]/,fe=/^[0-9]/,Ve=/^[.]/,Je=/^[a-zA-Z1-8\-=]/,qt=/^[+#]/,Ye=/^[!?]/,ze=/^[^}]/,Ze=/^[^\r\n]/,Xe=/^[ \t\r\n]/,Dt=R("tag pair"),Ut=N("[",!1),et=N('"',!1),Gt=N("]",!1),Ht=R("tag name"),Ie=q([["a","z"],["A","Z"]],!1,!1),Qt=R("tag value"),tt=q(['"'],!0,!1),jt=R("move number"),he=q([["0","9"]],!1,!1),Wt=N(".",!1),st=q(["."],!1,!1),Vt=R("standard algebraic notation"),Jt=N("O-O-O",!1),Yt=N("O-O",!1),zt=N("0-0-0",!1),Zt=N("0-0",!1),it=q([["a","z"],["A","Z"],["1","8"],"-","="],!1,!1),Xt=q(["+","#"],!1,!1),es=R("suffix annotation"),rt=q(["!","?"],!1,!1),ts=R("NAG"),ss=N("$",!1),is=R("brace comment"),rs=N("{",!1),nt=q(["}"],!0,!1),ns=N("}",!1),os=R("rest of line comment"),as=N(";",!1),ot=q(["\r",`
`],!0,!1),ls=R("variation"),cs=N("(",!1),fs=N(")",!1),hs=R("game termination marker"),us=N("1-0",!1),ds=N("0-1",!1),ps=N("1/2-1/2",!1),gs=N("*",!1),ms=R("whitespace"),at=q([" ","	","\r",`
`],!1,!1),_s=function(n,c){return Qs(n,c)},vs=function(n){return Object.fromEntries(n)},bs=function(n,c){return[n,c]},Es=function(n,c){return{root:n,marker:c}},ys=function(n,c){return Hs(Us(n),...c.flat())},Ss=function(n,c,f,v,b){return Gs(n,c,f,v,b)},ws=function(n){return n},Cs=function(n){return n.replace(/[\r\n]+/g," ")},ks=function(n){return n.trim()},As=function(n){return n},Ts=function(n,c){return{result:n,comment:c}},l=t.peg$currPos|0,Z=[{line:1,column:1}],F=l,ue=t.peg$maxFailExpected||[],d=t.peg$silentFails|0,re;if(t.startRule){if(!(t.startRule in r))throw new Error(`Can't start parsing from rule "`+t.startRule+'".');o=r[t.startRule]}function N(n,c){return{type:"literal",text:n,ignoreCase:c}}function q(n,c,f){return{type:"class",parts:n,inverted:c,ignoreCase:f}}function $s(){return{type:"end"}}function R(n){return{type:"other",description:n}}function lt(n){var c=Z[n],f;if(c)return c;if(n>=Z.length)f=Z.length-1;else for(f=n;!Z[--f];);for(c=Z[f],c={line:c.line,column:c.column};f<n;)i.charCodeAt(f)===10?(c.line++,c.column=1):c.column++,f++;return Z[n]=c,c}function ct(n,c,f){var v=lt(n),b=lt(c),k={source:s,start:{offset:n,line:v.line,column:v.column},end:{offset:c,line:b.line,column:b.column}};return k}function _(n){l<F||(l>F&&(F=l,ue=[]),ue.push(n))}function Is(n,c,f){return new ee(ee.buildMessage(n,c),n,c,f)}function ft(){var n,c,f;return n=l,c=Ls(),f=Os(),n=_s(c,f),n}function Ls(){var n,c,f;for(n=l,c=[],f=ht();f!==e;)c.push(f),f=ht();return f=B(),n=vs(c),n}function ht(){var n,c,f,v,b,k,W;return d++,n=l,B(),i.charCodeAt(l)===91?(c=a,l++):(c=e,d===0&&_(Ut)),c!==e?(B(),f=Ns(),f!==e?(B(),i.charCodeAt(l)===34?(v=h,l++):(v=e,d===0&&_(et)),v!==e?(b=Ps(),i.charCodeAt(l)===34?(k=h,l++):(k=e,d===0&&_(et)),k!==e?(B(),i.charCodeAt(l)===93?(W=u,l++):(W=e,d===0&&_(Gt)),W!==e?n=bs(f,b):(l=n,n=e)):(l=n,n=e)):(l=n,n=e)):(l=n,n=e)):(l=n,n=e),d--,n===e&&d===0&&_(Dt),n}function Ns(){var n,c,f;if(d++,n=l,c=[],f=i.charAt(l),$e.test(f)?l++:(f=e,d===0&&_(Ie)),f!==e)for(;f!==e;)c.push(f),f=i.charAt(l),$e.test(f)?l++:(f=e,d===0&&_(Ie));else c=e;return c!==e?n=i.substring(n,l):n=c,d--,n===e&&(c=e,d===0&&_(Ht)),n}function Ps(){var n,c,f;for(d++,n=l,c=[],f=i.charAt(l),We.test(f)?l++:(f=e,d===0&&_(tt));f!==e;)c.push(f),f=i.charAt(l),We.test(f)?l++:(f=e,d===0&&_(tt));return n=i.substring(n,l),d--,c=e,d===0&&_(Qt),n}function Os(){var n,c,f;return n=l,c=ut(),B(),f=Fs(),f===e&&(f=null),B(),n=Es(c,f),n}function ut(){var n,c,f,v;for(n=l,c=Le(),c===e&&(c=null),f=[],v=dt();v!==e;)f.push(v),v=dt();return n=ys(c,f),n}function dt(){var n,c,f,v,b,k,W,de;if(n=l,B(),xs(),B(),c=Ms(),c!==e){for(f=Bs(),f===e&&(f=null),v=[],b=pt();b!==e;)v.push(b),b=pt();for(b=B(),k=Le(),k===e&&(k=null),W=[],de=gt();de!==e;)W.push(de),de=gt();n=Ss(c,f,v,k,W)}else l=n,n=e;return n}function xs(){var n,c,f,v,b,k;for(d++,n=l,c=[],f=i.charAt(l),fe.test(f)?l++:(f=e,d===0&&_(he));f!==e;)c.push(f),f=i.charAt(l),fe.test(f)?l++:(f=e,d===0&&_(he));if(i.charCodeAt(l)===46?(f=p,l++):(f=e,d===0&&_(Wt)),f!==e){for(v=B(),b=[],k=i.charAt(l),Ve.test(k)?l++:(k=e,d===0&&_(st));k!==e;)b.push(k),k=i.charAt(l),Ve.test(k)?l++:(k=e,d===0&&_(st));c=[c,f,v,b],n=c}else l=n,n=e;return d--,n===e&&(c=e,d===0&&_(jt)),n}function Ms(){var n,c,f,v,b,k;if(d++,n=l,c=l,i.substr(l,5)===m?(f=m,l+=5):(f=e,d===0&&_(Jt)),f===e&&(i.substr(l,3)===w?(f=w,l+=3):(f=e,d===0&&_(Yt)),f===e&&(i.substr(l,5)===g?(f=g,l+=5):(f=e,d===0&&_(zt)),f===e&&(i.substr(l,3)===E?(f=E,l+=3):(f=e,d===0&&_(Zt)),f===e))))if(f=l,v=i.charAt(l),$e.test(v)?l++:(v=e,d===0&&_(Ie)),v!==e){if(b=[],k=i.charAt(l),Je.test(k)?l++:(k=e,d===0&&_(it)),k!==e)for(;k!==e;)b.push(k),k=i.charAt(l),Je.test(k)?l++:(k=e,d===0&&_(it));else b=e;b!==e?(v=[v,b],f=v):(l=f,f=e)}else l=f,f=e;return f!==e?(v=i.charAt(l),qt.test(v)?l++:(v=e,d===0&&_(Xt)),v===e&&(v=null),f=[f,v],c=f):(l=c,c=e),c!==e?n=i.substring(n,l):n=c,d--,n===e&&(c=e,d===0&&_(Vt)),n}function Bs(){var n,c,f;for(d++,n=l,c=[],f=i.charAt(l),Ye.test(f)?l++:(f=e,d===0&&_(rt));f!==e;)c.push(f),c.length>=2?f=e:(f=i.charAt(l),Ye.test(f)?l++:(f=e,d===0&&_(rt)));return c.length<1?(l=n,n=e):n=c,d--,n===e&&(c=e,d===0&&_(es)),n}function pt(){var n,c,f,v,b;if(d++,n=l,B(),i.charCodeAt(l)===36?(c=C,l++):(c=e,d===0&&_(ss)),c!==e){if(f=l,v=[],b=i.charAt(l),fe.test(b)?l++:(b=e,d===0&&_(he)),b!==e)for(;b!==e;)v.push(b),b=i.charAt(l),fe.test(b)?l++:(b=e,d===0&&_(he));else v=e;v!==e?f=i.substring(f,l):f=v,f!==e?n=ws(f):(l=n,n=e)}else l=n,n=e;return d--,n===e&&d===0&&_(ts),n}function Le(){var n;return n=Ks(),n===e&&(n=Rs()),n}function Ks(){var n,c,f,v,b;if(d++,n=l,i.charCodeAt(l)===123?(c=T,l++):(c=e,d===0&&_(rs)),c!==e){for(f=l,v=[],b=i.charAt(l),ze.test(b)?l++:(b=e,d===0&&_(nt));b!==e;)v.push(b),b=i.charAt(l),ze.test(b)?l++:(b=e,d===0&&_(nt));f=i.substring(f,l),i.charCodeAt(l)===125?(v=D,l++):(v=e,d===0&&_(ns)),v!==e?n=Cs(f):(l=n,n=e)}else l=n,n=e;return d--,n===e&&(c=e,d===0&&_(is)),n}function Rs(){var n,c,f,v,b;if(d++,n=l,i.charCodeAt(l)===59?(c=Ae,l++):(c=e,d===0&&_(as)),c!==e){for(f=l,v=[],b=i.charAt(l),Ze.test(b)?l++:(b=e,d===0&&_(ot));b!==e;)v.push(b),b=i.charAt(l),Ze.test(b)?l++:(b=e,d===0&&_(ot));f=i.substring(f,l),n=ks(f)}else l=n,n=e;return d--,n===e&&(c=e,d===0&&_(os)),n}function gt(){var n,c,f,v;return d++,n=l,B(),i.charCodeAt(l)===40?(c=Te,l++):(c=e,d===0&&_(cs)),c!==e?(f=ut(),f!==e?(B(),i.charCodeAt(l)===41?(v=Rt,l++):(v=e,d===0&&_(fs)),v!==e?n=As(f):(l=n,n=e)):(l=n,n=e)):(l=n,n=e),d--,n===e&&d===0&&_(ls),n}function Fs(){var n,c,f;return d++,n=l,i.substr(l,3)===He?(c=He,l+=3):(c=e,d===0&&_(us)),c===e&&(i.substr(l,3)===Qe?(c=Qe,l+=3):(c=e,d===0&&_(ds)),c===e&&(i.substr(l,7)===je?(c=je,l+=7):(c=e,d===0&&_(ps)),c===e&&(i.charCodeAt(l)===42?(c=Ft,l++):(c=e,d===0&&_(gs))))),c!==e?(B(),f=Le(),f===e&&(f=null),n=Ts(c,f)):(l=n,n=e),d--,n===e&&(c=e,d===0&&_(hs)),n}function B(){var n,c;for(d++,n=[],c=i.charAt(l),Xe.test(c)?l++:(c=e,d===0&&_(at));c!==e;)n.push(c),c=i.charAt(l),Xe.test(c)?l++:(c=e,d===0&&_(at));return d--,c=e,d===0&&_(ms),n}if(re=o(),t.peg$library)return{peg$result:re,peg$currPos:l,peg$FAILED:e,peg$maxFailExpected:ue,peg$maxFailPos:F};if(re!==e&&l===i.length)return re;throw re!==e&&l<i.length&&_($s()),Is(ue,F<i.length?i.charAt(F):null,F<i.length?ct(F,F+1):ct(F,F))}var ge=0xffffffffffffffffn;function Pe(i,t){return(i<<t|i>>64n-t)&0xffffffffffffffffn}function mt(i,t){return i*t&ge}function Vs(i){return function(){let t=BigInt(i&ge),e=BigInt(i>>64n&ge),s=mt(Pe(mt(t,5n),7n),9n);return e^=t,t=(Pe(t,24n)^e^e<<16n)&ge,e=Pe(e,37n),i=e<<64n|t,s}}var ve=Vs(0xa187eb39cdcaed8f31c4b365b102e01en),Js=Array.from({length:2},()=>Array.from({length:6},()=>Array.from({length:128},()=>ve()))),Ys=Array.from({length:8},()=>ve()),zs=Array.from({length:16},()=>ve()),Oe=ve(),M="w",K="b",I="p",Re="n",me="b",oe="r",H="q",L="k",xe="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",X=class{constructor(t,e){A(this,"color");A(this,"from");A(this,"to");A(this,"piece");A(this,"captured");A(this,"promotion");A(this,"flags");A(this,"san");A(this,"lan");A(this,"before");A(this,"after");let{color:s,piece:r,from:o,to:a,flags:h,captured:u,promotion:p}=e,m=P(o),w=P(a);this.color=s,this.piece=r,this.from=m,this.to=w,this.san=t._moveToSan(e,t._moves({legal:!0})),this.lan=m+w,this.before=t.fen(),t._makeMove(e),this.after=t.fen(),t._undoMove(),this.flags="";for(let g in S)S[g]&h&&(this.flags+=V[g]);u&&(this.captured=u),p&&(this.promotion=p,this.lan+=p)}isCapture(){return this.flags.indexOf(V.CAPTURE)>-1}isPromotion(){return this.flags.indexOf(V.PROMOTION)>-1}isEnPassant(){return this.flags.indexOf(V.EP_CAPTURE)>-1}isKingsideCastle(){return this.flags.indexOf(V.KSIDE_CASTLE)>-1}isQueensideCastle(){return this.flags.indexOf(V.QSIDE_CASTLE)>-1}isBigPawn(){return this.flags.indexOf(V.BIG_PAWN)>-1}},O=-1,V={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q",NULL_MOVE:"-"};var S={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64,NULL_MOVE:128},Fe={Event:"?",Site:"?",Date:"????.??.??",Round:"?",White:"?",Black:"?",Result:"*"},Zs={WhiteTitle:null,BlackTitle:null,WhiteElo:null,BlackElo:null,WhiteUSCF:null,BlackUSCF:null,WhiteNA:null,BlackNA:null,WhiteType:null,BlackType:null,EventDate:null,EventSponsor:null,Section:null,Stage:null,Board:null,Opening:null,Variation:null,SubVariation:null,ECO:null,NIC:null,Time:null,UTCTime:null,UTCDate:null,TimeControl:null,SetUp:null,FEN:null,Termination:null,Annotator:null,Mode:null,PlyCount:null},Xs={...Fe,...Zs},y={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},Me={b:[16,32,17,15],w:[-16,-32,-17,-15]},_t={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},ei=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],ti=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],si={p:1,n:2,b:4,r:8,q:16,k:32},ii="pnbrqkPNBRQK",vt=[Re,me,oe,H],ri=7,ni=6,oi=1,ai=0,pe={[L]:S.KSIDE_CASTLE,[H]:S.QSIDE_CASTLE},U={w:[{square:y.a1,flag:S.QSIDE_CASTLE},{square:y.h1,flag:S.KSIDE_CASTLE}],b:[{square:y.a8,flag:S.QSIDE_CASTLE},{square:y.h8,flag:S.KSIDE_CASTLE}]},li={b:oi,w:ni},Be="--";function J(i){return i>>4}function ae(i){return i&15}function Et(i){return"0123456789".indexOf(i)!==-1}function P(i){let t=ae(i),e=J(i);return"abcdefgh".substring(t,t+1)+"87654321".substring(e,e+1)}function ne(i){return i===M?K:M}function ci(i){let t=i.split(/\s+/);if(t.length!==6)return{ok:!1,error:"Invalid FEN: must contain six space-delimited fields"};let e=parseInt(t[5],10);if(isNaN(e)||e<=0)return{ok:!1,error:"Invalid FEN: move number must be a positive integer"};let s=parseInt(t[4],10);if(isNaN(s)||s<0)return{ok:!1,error:"Invalid FEN: half move counter number must be a non-negative integer"};if(!/^(-|[abcdefgh][36])$/.test(t[3]))return{ok:!1,error:"Invalid FEN: en-passant square is invalid"};if(/[^kKqQ-]/.test(t[2]))return{ok:!1,error:"Invalid FEN: castling availability is invalid"};if(!/^(w|b)$/.test(t[1]))return{ok:!1,error:"Invalid FEN: side-to-move is invalid"};let r=t[0].split("/");if(r.length!==8)return{ok:!1,error:"Invalid FEN: piece data does not contain 8 '/'-delimited rows"};for(let a=0;a<r.length;a++){let h=0,u=!1;for(let p=0;p<r[a].length;p++)if(Et(r[a][p])){if(u)return{ok:!1,error:"Invalid FEN: piece data is invalid (consecutive number)"};h+=parseInt(r[a][p],10),u=!0}else{if(!/^[prnbqkPRNBQK]$/.test(r[a][p]))return{ok:!1,error:"Invalid FEN: piece data is invalid (invalid piece)"};h+=1,u=!1}if(h!==8)return{ok:!1,error:"Invalid FEN: piece data is invalid (too many squares in rank)"}}if(t[3][1]=="3"&&t[1]=="w"||t[3][1]=="6"&&t[1]=="b")return{ok:!1,error:"Invalid FEN: illegal en-passant square"};let o=[{color:"white",regex:/K/g},{color:"black",regex:/k/g}];for(let{color:a,regex:h}of o){if(!h.test(t[0]))return{ok:!1,error:`Invalid FEN: missing ${a} king`};if((t[0].match(h)||[]).length>1)return{ok:!1,error:`Invalid FEN: too many ${a} kings`}}return Array.from(r[0]+r[7]).some(a=>a.toUpperCase()==="P")?{ok:!1,error:"Invalid FEN: some pawns are on the edge rows"}:{ok:!0}}function fi(i,t){let e=i.from,s=i.to,r=i.piece,o=0,a=0,h=0;for(let u=0,p=t.length;u<p;u++){let m=t[u].from,w=t[u].to,g=t[u].piece;r===g&&e!==m&&s===w&&(o++,J(e)===J(m)&&a++,ae(e)===ae(m)&&h++)}return o>0?a>0&&h>0?P(e):h>0?P(e).charAt(1):P(e).charAt(0):""}function G(i,t,e,s,r,o=void 0,a=S.NORMAL){let h=J(s);if(r===I&&(h===ri||h===ai))for(let u=0;u<vt.length;u++){let p=vt[u];i.push({color:t,from:e,to:s,piece:r,captured:o,promotion:p,flags:a|S.PROMOTION})}else i.push({color:t,from:e,to:s,piece:r,captured:o,flags:a})}function bt(i){let t=i.charAt(0);return t>="a"&&t<="h"?i.match(/[a-h]\d.*[a-h]\d/)?void 0:I:(t=t.toLowerCase(),t==="o"?L:t)}function Ke(i){return i.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}var _e=class{constructor(t=xe,{skipValidation:e=!1}={}){A(this,"_board",new Array(128));A(this,"_turn",M);A(this,"_header",{});A(this,"_kings",{w:O,b:O});A(this,"_epSquare",-1);A(this,"_halfMoves",0);A(this,"_moveNumber",0);A(this,"_history",[]);A(this,"_comments",{});A(this,"_castling",{w:0,b:0});A(this,"_hash",0n);A(this,"_positionCount",new Map);this.load(t,{skipValidation:e})}clear({preserveHeaders:t=!1}={}){this._board=new Array(128),this._kings={w:O,b:O},this._turn=M,this._castling={w:0,b:0},this._epSquare=O,this._halfMoves=0,this._moveNumber=1,this._history=[],this._comments={},this._header=t?this._header:{...Xs},this._hash=this._computeHash(),this._positionCount=new Map,this._header.SetUp=null,this._header.FEN=null}load(t,{skipValidation:e=!1,preserveHeaders:s=!1}={}){let r=t.split(/\s+/);if(r.length>=2&&r.length<6){let h=["-","-","0","1"];t=r.concat(h.slice(-(6-r.length))).join(" ")}if(r=t.split(/\s+/),!e){let{ok:h,error:u}=ci(t);if(!h)throw new Error(u)}let o=r[0],a=0;this.clear({preserveHeaders:s});for(let h=0;h<o.length;h++){let u=o.charAt(h);if(u==="/")a+=8;else if(Et(u))a+=parseInt(u,10);else{let p=u<"a"?M:K;this._put({type:u.toLowerCase(),color:p},P(a)),a++}}this._turn=r[1],r[2].indexOf("K")>-1&&(this._castling.w|=S.KSIDE_CASTLE),r[2].indexOf("Q")>-1&&(this._castling.w|=S.QSIDE_CASTLE),r[2].indexOf("k")>-1&&(this._castling.b|=S.KSIDE_CASTLE),r[2].indexOf("q")>-1&&(this._castling.b|=S.QSIDE_CASTLE),this._epSquare=r[3]==="-"?O:y[r[3]],this._halfMoves=parseInt(r[4],10),this._moveNumber=parseInt(r[5],10),this._hash=this._computeHash(),this._updateSetup(t),this._incPositionCount()}fen({forceEnpassantSquare:t=!1}={}){let e=0,s="";for(let a=y.a8;a<=y.h1;a++){if(this._board[a]){e>0&&(s+=e,e=0);let{color:h,type:u}=this._board[a];s+=h===M?u.toUpperCase():u.toLowerCase()}else e++;a+1&136&&(e>0&&(s+=e),a!==y.h1&&(s+="/"),e=0,a+=8)}let r="";this._castling[M]&S.KSIDE_CASTLE&&(r+="K"),this._castling[M]&S.QSIDE_CASTLE&&(r+="Q"),this._castling[K]&S.KSIDE_CASTLE&&(r+="k"),this._castling[K]&S.QSIDE_CASTLE&&(r+="q"),r=r||"-";let o="-";if(this._epSquare!==O)if(t)o=P(this._epSquare);else{let a=this._epSquare+(this._turn===M?16:-16),h=[a+1,a-1];for(let u of h){if(u&136)continue;let p=this._turn;if(this._board[u]?.color===p&&this._board[u]?.type===I){this._makeMove({color:p,from:u,to:this._epSquare,piece:I,captured:I,flags:S.EP_CAPTURE});let m=!this._isKingAttacked(p);if(this._undoMove(),m){o=P(this._epSquare);break}}}}return[s,this._turn,r,o,this._halfMoves,this._moveNumber].join(" ")}_pieceKey(t){if(!this._board[t])return 0n;let{color:e,type:s}=this._board[t],r={w:0,b:1}[e],o={p:0,n:1,b:2,r:3,q:4,k:5}[s];return Js[r][o][t]}_epKey(){return this._epSquare===O?0n:Ys[this._epSquare&7]}_castlingKey(){let t=this._castling.w>>5|this._castling.b>>3;return zs[t]}_computeHash(){let t=0n;for(let e=y.a8;e<=y.h1;e++){if(e&136){e+=7;continue}this._board[e]&&(t^=this._pieceKey(e))}return t^=this._epKey(),t^=this._castlingKey(),this._turn==="b"&&(t^=Oe),t}_updateSetup(t){this._history.length>0||(t!==xe?(this._header.SetUp="1",this._header.FEN=t):(this._header.SetUp=null,this._header.FEN=null))}reset(){this.load(xe)}get(t){return this._board[y[t]]}findPiece(t){let e=[];for(let s=y.a8;s<=y.h1;s++){if(s&136){s+=7;continue}!this._board[s]||this._board[s]?.color!==t.color||this._board[s].color===t.color&&this._board[s].type===t.type&&e.push(P(s))}return e}put({type:t,color:e},s){return this._put({type:t,color:e},s)?(this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),!0):!1}_set(t,e){this._hash^=this._pieceKey(t),this._board[t]=e,this._hash^=this._pieceKey(t)}_put({type:t,color:e},s){if(ii.indexOf(t.toLowerCase())===-1||!(s in y))return!1;let r=y[s];if(t==L&&!(this._kings[e]==O||this._kings[e]==r))return!1;let o=this._board[r];return o&&o.type===L&&(this._kings[o.color]=O),this._set(r,{type:t,color:e}),t===L&&(this._kings[e]=r),!0}_clear(t){this._hash^=this._pieceKey(t),delete this._board[t]}remove(t){let e=this.get(t);return this._clear(y[t]),e&&e.type===L&&(this._kings[e.color]=O),this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),e}_updateCastlingRights(){this._hash^=this._castlingKey();let t=this._board[y.e1]?.type===L&&this._board[y.e1]?.color===M,e=this._board[y.e8]?.type===L&&this._board[y.e8]?.color===K;(!t||this._board[y.a1]?.type!==oe||this._board[y.a1]?.color!==M)&&(this._castling.w&=-65),(!t||this._board[y.h1]?.type!==oe||this._board[y.h1]?.color!==M)&&(this._castling.w&=-33),(!e||this._board[y.a8]?.type!==oe||this._board[y.a8]?.color!==K)&&(this._castling.b&=-65),(!e||this._board[y.h8]?.type!==oe||this._board[y.h8]?.color!==K)&&(this._castling.b&=-33),this._hash^=this._castlingKey()}_updateEnPassantSquare(){if(this._epSquare===O)return;let t=this._epSquare+(this._turn===M?-16:16),e=this._epSquare+(this._turn===M?16:-16),s=[e+1,e-1];if(this._board[t]!==null||this._board[this._epSquare]!==null||this._board[e]?.color!==ne(this._turn)||this._board[e]?.type!==I){this._hash^=this._epKey(),this._epSquare=O;return}let r=o=>!(o&136)&&this._board[o]?.color===this._turn&&this._board[o]?.type===I;s.some(r)||(this._hash^=this._epKey(),this._epSquare=O)}_attacked(t,e,s){let r=[];for(let o=y.a8;o<=y.h1;o++){if(o&136){o+=7;continue}if(this._board[o]===void 0||this._board[o].color!==t)continue;let a=this._board[o],h=o-e;if(h===0)continue;let u=h+119;if(ei[u]&si[a.type]){if(a.type===I){if(h>0&&a.color===M||h<=0&&a.color===K)if(s)r.push(P(o));else return!0;continue}if(a.type==="n"||a.type==="k")if(s){r.push(P(o));continue}else return!0;let p=ti[u],m=o+p,w=!1;for(;m!==e;){if(this._board[m]!=null){w=!0;break}m+=p}if(!w)if(s){r.push(P(o));continue}else return!0}}return s?r:!1}attackers(t,e){return e?this._attacked(e,y[t],!0):this._attacked(this._turn,y[t],!0)}_isKingAttacked(t){let e=this._kings[t];return e===-1?!1:this._attacked(ne(t),e)}hash(){return this._hash.toString(16)}isAttacked(t,e){return this._attacked(e,y[t])}isCheck(){return this._isKingAttacked(this._turn)}inCheck(){return this.isCheck()}isCheckmate(){return this.isCheck()&&this._moves().length===0}isStalemate(){return!this.isCheck()&&this._moves().length===0}isInsufficientMaterial(){let t={b:0,n:0,r:0,q:0,k:0,p:0},e=[],s=0,r=0;for(let o=y.a8;o<=y.h1;o++){if(r=(r+1)%2,o&136){o+=7;continue}let a=this._board[o];a&&(t[a.type]=a.type in t?t[a.type]+1:1,a.type===me&&e.push(r),s++)}if(s===2)return!0;if(s===3&&(t[me]===1||t[Re]===1))return!0;if(s===t[me]+2){let o=0,a=e.length;for(let h=0;h<a;h++)o+=e[h];if(o===0||o===a)return!0}return!1}isThreefoldRepetition(){return this._getPositionCount(this._hash)>=3}isDrawByFiftyMoves(){return this._halfMoves>=100}isDraw(){return this.isDrawByFiftyMoves()||this.isStalemate()||this.isInsufficientMaterial()||this.isThreefoldRepetition()}isGameOver(){return this.isCheckmate()||this.isDraw()}moves({verbose:t=!1,square:e=void 0,piece:s=void 0}={}){let r=this._moves({square:e,piece:s});return t?r.map(o=>new X(this,o)):r.map(o=>this._moveToSan(o,r))}_moves({legal:t=!0,piece:e=void 0,square:s=void 0}={}){let r=s?s.toLowerCase():void 0,o=e?.toLowerCase(),a=[],h=this._turn,u=ne(h),p=y.a8,m=y.h1,w=!1;if(r)if(r in y)p=m=y[r],w=!0;else return[];for(let E=p;E<=m;E++){if(E&136){E+=7;continue}if(!this._board[E]||this._board[E].color===u)continue;let{type:C}=this._board[E],T;if(C===I){if(o&&o!==C)continue;T=E+Me[h][0],this._board[T]||(G(a,h,E,T,I),T=E+Me[h][1],li[h]===J(E)&&!this._board[T]&&G(a,h,E,T,I,void 0,S.BIG_PAWN));for(let D=2;D<4;D++)T=E+Me[h][D],!(T&136)&&(this._board[T]?.color===u?G(a,h,E,T,I,this._board[T].type,S.CAPTURE):T===this._epSquare&&G(a,h,E,T,I,I,S.EP_CAPTURE))}else{if(o&&o!==C)continue;for(let D=0,Ae=_t[C].length;D<Ae;D++){let Te=_t[C][D];for(T=E;T+=Te,!(T&136);){if(!this._board[T])G(a,h,E,T,C);else{if(this._board[T].color===h)break;G(a,h,E,T,C,this._board[T].type,S.CAPTURE);break}if(C===Re||C===L)break}}}}if((o===void 0||o===L)&&(!w||m===this._kings[h])){if(this._castling[h]&S.KSIDE_CASTLE){let E=this._kings[h],C=E+2;!this._board[E+1]&&!this._board[C]&&!this._attacked(u,this._kings[h])&&!this._attacked(u,E+1)&&!this._attacked(u,C)&&G(a,h,this._kings[h],C,L,void 0,S.KSIDE_CASTLE)}if(this._castling[h]&S.QSIDE_CASTLE){let E=this._kings[h],C=E-2;!this._board[E-1]&&!this._board[E-2]&&!this._board[E-3]&&!this._attacked(u,this._kings[h])&&!this._attacked(u,E-1)&&!this._attacked(u,C)&&G(a,h,this._kings[h],C,L,void 0,S.QSIDE_CASTLE)}}if(!t||this._kings[h]===-1)return a;let g=[];for(let E=0,C=a.length;E<C;E++)this._makeMove(a[E]),this._isKingAttacked(h)||g.push(a[E]),this._undoMove();return g}move(t,{strict:e=!1}={}){let s=null;if(typeof t=="string")s=this._moveFromSan(t,e);else if(t===null)s=this._moveFromSan(Be,e);else if(typeof t=="object"){let o=this._moves();for(let a=0,h=o.length;a<h;a++)if(t.from===P(o[a].from)&&t.to===P(o[a].to)&&(!("promotion"in o[a])||t.promotion===o[a].promotion)){s=o[a];break}}if(!s)throw typeof t=="string"?new Error(`Invalid move: ${t}`):new Error(`Invalid move: ${JSON.stringify(t)}`);if(this.isCheck()&&s.flags&S.NULL_MOVE)throw new Error("Null move not allowed when in check");let r=new X(this,s);return this._makeMove(s),this._incPositionCount(),r}_push(t){this._history.push({move:t,kings:{b:this._kings.b,w:this._kings.w},turn:this._turn,castling:{b:this._castling.b,w:this._castling.w},epSquare:this._epSquare,halfMoves:this._halfMoves,moveNumber:this._moveNumber})}_movePiece(t,e){this._hash^=this._pieceKey(t),this._board[e]=this._board[t],delete this._board[t],this._hash^=this._pieceKey(e)}_makeMove(t){let e=this._turn,s=ne(e);if(this._push(t),t.flags&S.NULL_MOVE){e===K&&this._moveNumber++,this._halfMoves++,this._turn=s,this._epSquare=O;return}if(this._hash^=this._epKey(),this._hash^=this._castlingKey(),t.captured&&(this._hash^=this._pieceKey(t.to)),this._movePiece(t.from,t.to),t.flags&S.EP_CAPTURE&&(this._turn===K?this._clear(t.to-16):this._clear(t.to+16)),t.promotion&&(this._clear(t.to),this._set(t.to,{type:t.promotion,color:e})),this._board[t.to].type===L){if(this._kings[e]=t.to,t.flags&S.KSIDE_CASTLE){let r=t.to-1,o=t.to+1;this._movePiece(o,r)}else if(t.flags&S.QSIDE_CASTLE){let r=t.to+1,o=t.to-2;this._movePiece(o,r)}this._castling[e]=0}if(this._castling[e]){for(let r=0,o=U[e].length;r<o;r++)if(t.from===U[e][r].square&&this._castling[e]&U[e][r].flag){this._castling[e]^=U[e][r].flag;break}}if(this._castling[s]){for(let r=0,o=U[s].length;r<o;r++)if(t.to===U[s][r].square&&this._castling[s]&U[s][r].flag){this._castling[s]^=U[s][r].flag;break}}if(this._hash^=this._castlingKey(),t.flags&S.BIG_PAWN){let r;e===K?r=t.to-16:r=t.to+16,!(t.to-1&136)&&this._board[t.to-1]?.type===I&&this._board[t.to-1]?.color===s||!(t.to+1&136)&&this._board[t.to+1]?.type===I&&this._board[t.to+1]?.color===s?(this._epSquare=r,this._hash^=this._epKey()):this._epSquare=O}else this._epSquare=O;t.piece===I?this._halfMoves=0:t.flags&(S.CAPTURE|S.EP_CAPTURE)?this._halfMoves=0:this._halfMoves++,e===K&&this._moveNumber++,this._turn=s,this._hash^=Oe}undo(){let t=this._hash,e=this._undoMove();if(e){let s=new X(this,e);return this._decPositionCount(t),s}return null}_undoMove(){let t=this._history.pop();if(t===void 0)return null;this._hash^=this._epKey(),this._hash^=this._castlingKey();let e=t.move;this._kings=t.kings,this._turn=t.turn,this._castling=t.castling,this._epSquare=t.epSquare,this._halfMoves=t.halfMoves,this._moveNumber=t.moveNumber,this._hash^=this._epKey(),this._hash^=this._castlingKey(),this._hash^=Oe;let s=this._turn,r=ne(s);if(e.flags&S.NULL_MOVE)return e;if(this._movePiece(e.to,e.from),e.piece&&(this._clear(e.from),this._set(e.from,{type:e.piece,color:s})),e.captured)if(e.flags&S.EP_CAPTURE){let o;s===K?o=e.to-16:o=e.to+16,this._set(o,{type:I,color:r})}else this._set(e.to,{type:e.captured,color:r});if(e.flags&(S.KSIDE_CASTLE|S.QSIDE_CASTLE)){let o,a;e.flags&S.KSIDE_CASTLE?(o=e.to+1,a=e.to-1):(o=e.to-2,a=e.to+1),this._movePiece(a,o)}return e}pgn({newline:t=`
`,maxWidth:e=0}={}){let s=[],r=!1;for(let g in this._header)this._header[g]&&s.push(`[${g} "${this._header[g]}"]`+t),r=!0;r&&this._history.length&&s.push(t);let o=g=>{let E=this._comments[this.fen()];if(typeof E<"u"){let C=g.length>0?" ":"";g=`${g}${C}{${E}}`}return g},a=[];for(;this._history.length>0;)a.push(this._undoMove());let h=[],u="";for(a.length===0&&h.push(o(""));a.length>0;){u=o(u);let g=a.pop();if(!g)break;if(!this._history.length&&g.color==="b"){let E=`${this._moveNumber}. ...`;u=u?`${u} ${E}`:E}else g.color==="w"&&(u.length&&h.push(u),u=this._moveNumber+".");u=u+" "+this._moveToSan(g,this._moves({legal:!0})),this._makeMove(g)}if(u.length&&h.push(o(u)),h.push(this._header.Result||"*"),e===0)return s.join("")+h.join(" ");let p=function(){return s.length>0&&s[s.length-1]===" "?(s.pop(),!0):!1},m=function(g,E){for(let C of E.split(" "))if(C){if(g+C.length>e){for(;p();)g--;s.push(t),g=0}s.push(C),g+=C.length,s.push(" "),g++}return p()&&g--,g},w=0;for(let g=0;g<h.length;g++){if(w+h[g].length>e&&h[g].includes("{")){w=m(w,h[g]);continue}w+h[g].length>e&&g!==0?(s[s.length-1]===" "&&s.pop(),s.push(t),w=0):g!==0&&(s.push(" "),w++),s.push(h[g]),w+=h[g].length}return s.join("")}header(...t){for(let e=0;e<t.length;e+=2)typeof t[e]=="string"&&typeof t[e+1]=="string"&&(this._header[t[e]]=t[e+1]);return this._header}setHeader(t,e){return this._header[t]=e??Fe[t]??null,this.getHeaders()}removeHeader(t){return t in this._header?(this._header[t]=Fe[t]||null,!0):!1}getHeaders(){let t={};for(let[e,s]of Object.entries(this._header))s!==null&&(t[e]=s);return t}loadPgn(t,{strict:e=!1,newlineChar:s=`\r?
`}={}){s!==`\r?
`&&(t=t.replace(new RegExp(s,"g"),`
`));let r=Ws(t);this.reset();let o=r.headers,a="";for(let p in o)p.toLowerCase()==="fen"&&(a=o[p]),this.header(p,o[p]);if(!e)a&&this.load(a,{preserveHeaders:!0});else if(o.SetUp==="1"){if(!("FEN"in o))throw new Error("Invalid PGN: FEN tag must be supplied with SetUp tag");this.load(o.FEN,{preserveHeaders:!0})}let h=r.root;for(;h;){if(h.move){let p=this._moveFromSan(h.move,e);if(p==null)throw new Error(`Invalid move in PGN: ${h.move}`);this._makeMove(p),this._incPositionCount()}h.comment!==void 0&&(this._comments[this.fen()]=h.comment),h=h.variations[0]}let u=r.result;u&&Object.keys(this._header).length&&this._header.Result!==u&&this.setHeader("Result",u)}_moveToSan(t,e){let s="";if(t.flags&S.KSIDE_CASTLE)s="O-O";else if(t.flags&S.QSIDE_CASTLE)s="O-O-O";else{if(t.flags&S.NULL_MOVE)return Be;if(t.piece!==I){let r=fi(t,e);s+=t.piece.toUpperCase()+r}t.flags&(S.CAPTURE|S.EP_CAPTURE)&&(t.piece===I&&(s+=P(t.from)[0]),s+="x"),s+=P(t.to),t.promotion&&(s+="="+t.promotion.toUpperCase())}return this._makeMove(t),this.isCheck()&&(this.isCheckmate()?s+="#":s+="+"),this._undoMove(),s}_moveFromSan(t,e=!1){let s=Ke(t);if(e||(s==="0-0"?s="O-O":s==="0-0-0"&&(s="O-O-O")),s==Be)return{color:this._turn,from:0,to:0,piece:"k",flags:S.NULL_MOVE};let r=bt(s),o=this._moves({legal:!0,piece:r});for(let g=0,E=o.length;g<E;g++)if(s===Ke(this._moveToSan(o[g],o)))return o[g];if(e)return null;let a,h,u,p,m,w=!1;if(h=s.match(/([pnbrqkPNBRQK])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBN])?/),h?(a=h[1],u=h[2],p=h[3],m=h[4],u.length==1&&(w=!0)):(h=s.match(/([pnbrqkPNBRQK])?([a-h]?[1-8]?)x?-?([a-h][1-8])([qrbnQRBN])?/),h&&(a=h[1],u=h[2],p=h[3],m=h[4],u.length==1&&(w=!0))),r=bt(s),o=this._moves({legal:!0,piece:a||r}),!p)return null;for(let g=0,E=o.length;g<E;g++)if(u){if((!a||a.toLowerCase()==o[g].piece)&&y[u]==o[g].from&&y[p]==o[g].to&&(!m||m.toLowerCase()==o[g].promotion))return o[g];if(w){let C=P(o[g].from);if((!a||a.toLowerCase()==o[g].piece)&&y[p]==o[g].to&&(u==C[0]||u==C[1])&&(!m||m.toLowerCase()==o[g].promotion))return o[g]}}else if(s===Ke(this._moveToSan(o[g],o)).replace("x",""))return o[g];return null}ascii(){let t=`   +------------------------+
`;for(let e=y.a8;e<=y.h1;e++){if(ae(e)===0&&(t+=" "+"87654321"[J(e)]+" |"),this._board[e]){let s=this._board[e].type,o=this._board[e].color===M?s.toUpperCase():s.toLowerCase();t+=" "+o+" "}else t+=" . ";e+1&136&&(t+=`|
`,e+=8)}return t+=`   +------------------------+
`,t+="     a  b  c  d  e  f  g  h",t}perft(t){let e=this._moves({legal:!1}),s=0,r=this._turn;for(let o=0,a=e.length;o<a;o++)this._makeMove(e[o]),this._isKingAttacked(r)||(t-1>0?s+=this.perft(t-1):s++),this._undoMove();return s}setTurn(t){return this._turn==t?!1:(this.move("--"),!0)}turn(){return this._turn}board(){let t=[],e=[];for(let s=y.a8;s<=y.h1;s++)this._board[s]==null?e.push(null):e.push({square:P(s),type:this._board[s].type,color:this._board[s].color}),s+1&136&&(t.push(e),e=[],s+=8);return t}squareColor(t){if(t in y){let e=y[t];return(J(e)+ae(e))%2===0?"light":"dark"}return null}history({verbose:t=!1}={}){let e=[],s=[];for(;this._history.length>0;)e.push(this._undoMove());for(;;){let r=e.pop();if(!r)break;t?s.push(new X(this,r)):s.push(this._moveToSan(r,this._moves())),this._makeMove(r)}return s}_getPositionCount(t){return this._positionCount.get(t)??0}_incPositionCount(){this._positionCount.set(this._hash,(this._positionCount.get(this._hash)??0)+1)}_decPositionCount(t){let e=this._positionCount.get(t)??0;e===1?this._positionCount.delete(t):this._positionCount.set(t,e-1)}_pruneComments(){let t=[],e={},s=r=>{r in this._comments&&(e[r]=this._comments[r])};for(;this._history.length>0;)t.push(this._undoMove());for(s(this.fen());;){let r=t.pop();if(!r)break;this._makeMove(r),s(this.fen())}this._comments=e}getComment(){return this._comments[this.fen()]}setComment(t){this._comments[this.fen()]=t.replace("{","[").replace("}","]")}deleteComment(){return this.removeComment()}removeComment(){let t=this._comments[this.fen()];return delete this._comments[this.fen()],t}getComments(){return this._pruneComments(),Object.keys(this._comments).map(t=>({fen:t,comment:this._comments[t]}))}deleteComments(){return this.removeComments()}removeComments(){return this._pruneComments(),Object.keys(this._comments).map(t=>{let e=this._comments[t];return delete this._comments[t],{fen:t,comment:e}})}setCastlingRights(t,e){for(let r of[L,H])e[r]!==void 0&&(e[r]?this._castling[t]|=pe[r]:this._castling[t]&=~pe[r]);this._updateCastlingRights();let s=this.getCastlingRights(t);return(e[L]===void 0||e[L]===s[L])&&(e[H]===void 0||e[H]===s[H])}getCastlingRights(t){return{[L]:(this._castling[t]&pe[L])!==0,[H]:(this._castling[t]&pe[H])!==0}}moveNumber(){return this._moveNumber}};var yt=0,Ue="chessgpt",Q=!1;function Ee(i,t=null){try{let e=localStorage.getItem(i);return e!==null?e:t}catch(e){return console.warn("localStorage read error:",e),t}}function ye(i,t){try{return localStorage.setItem(i,t),!0}catch(e){return console.warn("localStorage write error:",e),!1}}function St(i,t=[]){try{let e=localStorage.getItem(i);return e?JSON.parse(e):t}catch(e){return console.warn("localStorage JSON parse error:",e),t}}function wt(i,t){try{return localStorage.setItem(i,JSON.stringify(t)),!0}catch(e){return console.warn("localStorage JSON write error:",e),!1}}function Ct(i){try{let t=i==="victory"?vi:bi;t&&(t.volume=.5,t.currentTime=0,t.play().catch(e=>console.warn("Audio play failed:",e)))}catch(t){console.warn("Sound playback error:",t)}}function Nt(i,t){let e=document.getElementById("myBoard");Ot.classList.remove("d-none"),xt.classList.add("d-none"),z.value=Ee("lastNickname",""),Ge=i,i==="ai"?(te.textContent="DEFEATED!",te.className="game-over-title defeat",se.src=Ue==="stockfish"?"/stockfish.png":"/chatgpt.png",se.className="game-over-logo defeat",e.classList.add("shake"),Ct("defeat"),setTimeout(()=>e.classList.remove("shake"),500)):i==="player"?(te.textContent="VICTORY!",te.className="game-over-title victory",se.src="/red.png",se.className="game-over-logo victory",Ct("victory"),typeof confetti=="function"&&(confetti({particleCount:100,spread:70,origin:{y:.6}}),setTimeout(()=>{confetti({particleCount:50,angle:60,spread:55,origin:{x:0}}),confetti({particleCount:50,angle:120,spread:55,origin:{x:1}})},250))):(te.textContent="DRAW",te.className="game-over-title draw",se.src="/chatgpt.png",se.className="game-over-logo"),gi.textContent=t,j&&(j.textContent="Restart",j.classList.remove("btn-outline-danger"),j.classList.add("btn-outline-warning")),new bootstrap.Modal(pi).show()}async function Pt(i,t=10){try{let e=await fetch(`/api/leaderboard?limit=${t}`);if(!e.ok)throw new Error("Failed to fetch leaderboard");let s=await e.json();if(i.innerHTML="",s.length===0){i.innerHTML='<tr><td colspan="5" class="text-center text-muted">No entries yet</td></tr>';return}s.forEach((r,o)=>{let a=document.createElement("tr");a.innerHTML=`
        <td>${o+1}</td>
        <td>${ui(r.nickname)}</td>
        <td>${r.wins}</td>
        <td>${r.losses}</td>
        <td>${r.draws}</td>
      `,i.appendChild(a)})}catch(e){console.warn("Leaderboard fetch error:",e),i.innerHTML='<tr><td colspan="5" class="text-center text-muted">Could not load leaderboard</td></tr>'}}async function hi(i,t){try{let e=await fetch("/api/leaderboard",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({nickname:i,result:t})});if(!e.ok){let s=await e.json();throw new Error(s.error||"Submission failed")}return!0}catch(e){return console.error("Score submission error:",e),!1}}function ui(i){let t=document.createElement("div");return t.textContent=i,t.innerHTML}var be=document.getElementById("container"),qe=document.getElementById("startAnimation"),di=document.getElementById("startContainer"),De=document.getElementById("chessBoard"),Se=document.getElementById("myBoard"),ce=document.getElementById("chatGptLogo"),we=document.getElementById("redLogo"),pi=document.getElementById("gameOverModal"),te=document.getElementById("gameOverTitle"),gi=document.getElementById("gameOverStatus"),se=document.getElementById("gameOverLogo"),z=document.getElementById("nicknameInput"),Y=document.getElementById("submitScoreBtn"),Ot=document.getElementById("leaderboardSubmit"),xt=document.getElementById("leaderboardDisplay"),mi=document.getElementById("leaderboardBody"),kt=document.getElementById("playAgainBtn"),Ce=document.getElementById("viewLeaderboardBtn"),_i=document.getElementById("standaloneLeaderboardBody"),j=document.getElementById("resignRestartBtn"),vi=document.getElementById("audio-victory"),bi=document.getElementById("audio-defeat"),Ge=null,ke=document.getElementById("audio-element"),Ki=document.getElementById("audio-element-metal"),ie=window.innerWidth<700?20:55,Ei=7.5,At=[];function yi(i,t){let e=document.createElement("div");return e.classList.add("block"),e.style.left=`${i*ie}px`,e.style.top=`${t*ie}px`,be.appendChild(e),e}function Si(i){return new Promise(t=>setTimeout(t,i))}async function wi(){let i=0,t=0,e=1,s=0,r=Math.ceil(window.innerWidth/ie),o=Math.ceil(window.innerHeight/ie);for(let a=0;a<r*o;a++){if(At.push(yi(i,t)),i+e>=r||i+e<0||t+s>=o||t+s<0||At.some(h=>h.style.left===`${(i+e)*ie}px`&&h.style.top===`${(t+s)*ie}px`)){let h=e;e=-s,s=h}i+=e,t+=s,await Si(Ei)}}qe.addEventListener("click",async()=>{if(Ee("volumeMessageShown")!=="true"){let t=document.getElementById("volumeMessage");new bootstrap.Modal(t).show(),ye("volumeMessageShown","true");return}let i=900;for(let t=0;t<10;t++)setTimeout(()=>{qe.classList.toggle("d-none")},t*150);ke.play(),setTimeout(async()=>{qe.classList.add("d-none"),di.classList.add("d-none"),be.classList.remove("d-none"),await wi(),be.innerHTML="",be.classList.add("d-none"),De.classList.remove("hidden"),De.classList.remove("d-none"),De.classList.remove("visible"),Bt(ke,1,.1,1e4),setTimeout(()=>{ce.classList.remove("d-none"),we.classList.remove("d-none"),setTimeout(()=>{ce.style.left="80%",we.style.left="10%"},400),setTimeout(()=>{Se.classList.add("visible"),Se.classList.remove("hidden")},2200)},50)},i)});function Mt(i,t,e,s){let o=s/50,a=(e-t)/o,h=e>t;i.volume=t;let u=setInterval(()=>{i.volume+=a,i.volume=Math.max(0,Math.min(1,i.volume)),(h?i.volume>=e:i.volume<=e)&&(i.volume=e,clearInterval(u))},50)}var Bt=Mt,Ci=Mt;function ki(){let i=document.getElementById("audio-element-metal");setTimeout(()=>{Bt(ke,.1,0,5e3),i.volume=0,i.play(),Ci(i,0,1,1e4),setTimeout(()=>{ke.volume=0},1e3)},2e3)}try{let i=function(r,o,a,h){if(x.isGameOver()||Q||o.search(/^b/)!==-1||x.turn()!=="w")return!1},e=function(){le.position(x.fen())},s=function(){var r="",o=!1,a="",h="White";if(x.turn()==="b"&&(h="Black"),x.isCheckmate()?(r="Game over, "+h+" is in checkmate.",h==="Black"?a="w":a="b",o=!0):x.isDraw()?(r="Game over, drawn position",o=!0):(r=h+" to move",x.isCheck()&&(r+=", "+h+" is in check")),Tt.html(r),$t.html(x.fen()),It.html(x.pgn()),o){let u="draw";a==="w"?u="player":a==="b"&&(u="ai"),Nt(u,r),Ti(a)}};Li=i,Ni=e,Pi=s,console.log("Chessboard.js version:",Chessboard.version),le=null,x=new _e,Tt=$("#status"),$t=$("#fen"),It=$("#pgn");async function t(r,o){if(Q||x.turn()!=="w")return"snapback";var a=x.move({from:r,to:o,promotion:"q"});if(a===null)return"snapback";var h=St("moves",[]);h.push(a.san),wt("moves",h),le.position(x.fen()),yt++,yt===6&&(await new Promise(u=>setTimeout(u,2e3)),await Ai(),Ue="stockfish"),Q=!0,$.get("/ai-move",{fen:x.fen(),bot:Ue,an:JSON.stringify(h)}).done(function(u){if(typeof u=="object"){if(u.error){console.error("Server error:",u.error),Q=!1;return}if(u.msg){console.log("Game state:",u.msg),s(),Q=!1;return}}var p=x.move(u);if(p===null){console.error("Received invalid move from server:",u),Q=!1;return}var m=St("moves",[]);m.push(u),wt("moves",m),le.position(x.fen()),s(),Q=!1}).fail(function(u){console.error("Server request failed:",u.status,u.responseJSON),Q=!1})}Lt={draggable:!0,position:"start",onDragStart:i,onDrop:t,onSnapEnd:e},le=Chessboard("myBoard",Lt),s()}catch(i){console.error("Chess initialization error:",i)}var le,x,Tt,$t,It,Lt,Li,Ni,Pi;async function Ai(){var i=document.getElementById("evolutionModal");let t=new bootstrap.Modal(i);t.show();let e=document.getElementById("evolutionImage");await new Promise(a=>setTimeout(a,2e3)),e.src="/stockfish.png",await new Promise(a=>setTimeout(a,250)),e.src="/chatgpt.png",await new Promise(a=>setTimeout(a,1e3)),e.src="/stockfish.png",await new Promise(a=>setTimeout(a,250)),e.src="/chatgpt.png",ki(),await new Promise(a=>setTimeout(a,750)),e.src="/stockfish.png",await new Promise(a=>setTimeout(a,500)),e.src="/chatgpt.png",await new Promise(a=>setTimeout(a,250)),e.src="/stockfish.png",await new Promise(a=>setTimeout(a,500));let s=document.getElementById("evolvedStart"),r=document.getElementById("evolvedFinal");s.classList.add("d-none"),r.classList.remove("d-none"),await new Promise(a=>setTimeout(a,500));let o=document.getElementById("elo");o.innerText="ELO: 3607",o.classList.remove("bg-dark"),o.classList.add("bg-danger"),o.classList.add("fs-1"),o.classList.remove("p-2"),o.classList.add("p-3"),await new Promise(a=>setTimeout(a,4e3)),ce.src="/stockfish.png",t.hide()}function Kt(){window.innerWidth<=767?(we.style.top="90%",ce.style.top="2%"):(we.style.top="75%",ce.style.top="5%")}window.addEventListener("load",Kt);window.addEventListener("resize",Kt);async function Ti(i="b"){let t=parseInt(Ee("chessGptScoreValue","0"),10)||0,e=parseInt(Ee("yourScore","0"),10)||0;i==="b"&&t++,i==="w"&&e++;let s=document.getElementById("chessGptScore"),r=document.getElementById("yourScore");s&&(s.innerText=t),r&&(r.innerText=e),ye("chessGptScoreValue",t.toString()),ye("yourScore",e.toString())}var $i=document.getElementById("resetBtn");$i.addEventListener("click",()=>{window.location.reload()});kt&&kt.addEventListener("click",()=>{window.location.reload()});Y&&Y.addEventListener("click",async()=>{let i=z.value.trim();if(!i){z.classList.add("border-danger"),z.focus();return}z.classList.remove("border-danger");let t;Ge==="player"?t="win":Ge==="ai"?t="loss":t="draw",Y.disabled=!0,Y.textContent="Submitting...",ye("lastNickname",i),await hi(i,t)?(Ot.classList.add("d-none"),xt.classList.remove("d-none"),await Pt(mi)):(Y.disabled=!1,Y.textContent="Try Again")});z&&z.addEventListener("keypress",i=>{i.key==="Enter"&&Y.click()});Ce&&Ce.addEventListener("click",async()=>{let i=document.getElementById("leaderboardModal");new bootstrap.Modal(i).show(),await Pt(_i)});j&&j.addEventListener("click",function(){x.isGameOver()?window.location.reload():Nt("ai","You resigned!")});var Ii=new MutationObserver(i=>{i.forEach(t=>{t.target.classList.contains("visible")&&!t.target.classList.contains("hidden")&&(Ce&&Ce.classList.remove("d-none"),j&&j.classList.remove("d-none"))})});Se&&Ii.observe(Se,{attributes:!0,attributeFilter:["class"]});})();
/*! Bundled license information:

chess.js/dist/esm/chess.js:
  (**
   * @license
   * Copyright (c) 2025, Jeff Hlywa (jhlywa@gmail.com)
   * All rights reserved.
   *
   * Redistribution and use in source and binary forms, with or without
   * modification, are permitted provided that the following conditions are met:
   *
   * 1. Redistributions of source code must retain the above copyright notice,
   *    this list of conditions and the following disclaimer.
   * 2. Redistributions in binary form must reproduce the above copyright notice,
   *    this list of conditions and the following disclaimer in the documentation
   *    and/or other materials provided with the distribution.
   *
   * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
   * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
   * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
   * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE
   * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
   * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
   * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
   * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
   * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
   * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
   * POSSIBILITY OF SUCH DAMAGE.
   *)
*/
