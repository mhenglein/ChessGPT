const SYMBOLS="pnbrqkPNBRQK",DEFAULT_POSITION="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",TERMINATION_MARKERS=["1-0","0-1","1/2-1/2","*"],PAWN_OFFSETS={b:[16,32,17,15],w:[-16,-32,-17,-15]},PIECE_OFFSETS={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},ATTACKS=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],RAYS=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],SHIFTS={p:0,n:1,b:2,r:3,q:4,k:5},BITS={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64},RANK_1=7,RANK_2=6,RANK_3=5,RANK_4=4,RANK_5=3,RANK_6=2,RANK_7=1,RANK_8=0,SQUARE_MAP={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},ROOKS={w:[{square:SQUARE_MAP.a1,flag:BITS.QSIDE_CASTLE},{square:SQUARE_MAP.h1,flag:BITS.KSIDE_CASTLE}],b:[{square:SQUARE_MAP.a8,flag:BITS.QSIDE_CASTLE},{square:SQUARE_MAP.h8,flag:BITS.KSIDE_CASTLE}]},PARSER_STRICT=0,PARSER_SLOPPY=1;function get_disambiguator(e,r){for(var n=e.from,t=e.to,o=e.piece,i=0,a=0,l=0,f=0,u=r.length;f<u;f++){var s=r[f].from,c=r[f].to;o===r[f].piece&&n!==s&&t===c&&(i++,rank(n)===rank(s)&&a++,file(n)===file(s)&&l++)}return i>0?a>0&&l>0?algebraic(n):l>0?algebraic(n).charAt(1):algebraic(n).charAt(0):""}function infer_piece_type(e){var r=e.charAt(0);if(r>="a"&&r<="h"){if(e.match(/[a-h]\d.*[a-h]\d/))return;return PAWN}return"o"===(r=r.toLowerCase())?KING:r}function stripped_san(e){return e.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}function rank(e){return e>>4}function file(e){return 15&e}function algebraic(e){var r=file(e),n=rank(e);return"abcdefgh".substring(r,r+1)+"87654321".substring(n,n+1)}function swap_color(e){return e===WHITE?BLACK:WHITE}function is_digit(e){return-1!=="0123456789".indexOf(e)}function clone(e){var r=e instanceof Array?[]:{};for(var n in e)r[n]="object"==typeof n?clone(e[n]):e[n];return r}function trim(e){return e.replace(/^\s+|\s+$/g,"")}export const BLACK="b";export const WHITE="w";export const EMPTY=-1;export const PAWN="p";export const KNIGHT="n";export const BISHOP="b";export const ROOK="r";export const QUEEN="q";export const KING="k";export const SQUARES=function(){for(var e=[],r=SQUARE_MAP.a8;r<=SQUARE_MAP.h1;r++)136&r?r+=7:e.push(algebraic(r));return e}();export const FLAGS={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q"};export const Chess=function(e){var r=new Array(128),n={w:-1,b:-1},t=WHITE,o={w:0,b:0},i=-1,a=0,l=1,f=[],u={},s={};function c(e){void 0===e&&(e=!1),r=new Array(128),n={w:-1,b:-1},t=WHITE,o={w:0,b:0},i=-1,a=0,l=1,f=[],e||(u={}),s={},h(v())}function p(){for(var e=[],r={},n=function(e){e in s&&(r[e]=s[e])};f.length>0;)e.push(w());for(n(v());e.length>0;)y(e.pop()),n(v());s=r}function g(){S(DEFAULT_POSITION)}function S(e,r){void 0===r&&(r=!1);var n=e.split(/\s+/),f=n[0],u=0;if(!A(e).valid)return!1;c(r);for(var s=0;s<f.length;s++){var p=f.charAt(s);if("/"===p)u+=8;else if(is_digit(p))u+=parseInt(p,10);else{var g=p<"a"?WHITE:BLACK;T({type:p.toLowerCase(),color:g},algebraic(u)),u++}}return t=n[1],n[2].indexOf("K")>-1&&(o.w|=BITS.KSIDE_CASTLE),n[2].indexOf("Q")>-1&&(o.w|=BITS.QSIDE_CASTLE),n[2].indexOf("k")>-1&&(o.b|=BITS.KSIDE_CASTLE),n[2].indexOf("q")>-1&&(o.b|=BITS.QSIDE_CASTLE),i="-"===n[3]?-1:SQUARE_MAP[n[3]],a=parseInt(n[4],10),l=parseInt(n[5],10),h(v()),!0}function A(e){var r="No errors.",n="FEN string must contain six space-delimited fields.",t="6th field (move number) must be a positive integer.",o="5th field (half move counter) must be a non-negative integer.",i="4th field (en-passant square) is invalid.",a="3rd field (castling availability) is invalid.",l="2nd field (side to move) is invalid.",f="1st field (piece positions) does not contain 8 '/'-delimited rows.",u="1st field (piece positions) is invalid [consecutive numbers].",s="1st field (piece positions) is invalid [invalid piece].",c="1st field (piece positions) is invalid [row too large].",p="Illegal en-passant square",g=e.split(/\s+/);if(6!==g.length)return{valid:!1,error_number:1,error:n};if(isNaN(parseInt(g[5]))||parseInt(g[5],10)<=0)return{valid:!1,error_number:2,error:t};if(isNaN(parseInt(g[4]))||parseInt(g[4],10)<0)return{valid:!1,error_number:3,error:o};if(!/^(-|[abcdefgh][36])$/.test(g[3]))return{valid:!1,error_number:4,error:i};if(!/^(KQ?k?q?|Qk?q?|kq?|q|-)$/.test(g[2]))return{valid:!1,error_number:5,error:a};if(!/^(w|b)$/.test(g[1]))return{valid:!1,error_number:6,error:l};var S=g[0].split("/");if(8!==S.length)return{valid:!1,error_number:7,error:f};for(var A=0;A<S.length;A++){for(var v=0,E=!1,h=0;h<S[A].length;h++)if(isNaN(S[A][h])){if(!/^[prnbqkPRNBQK]$/.test(S[A][h]))return{valid:!1,error_number:9,error:s};v+=1,E=!1}else{if(E)return{valid:!1,error_number:8,error:u};v+=parseInt(S[A][h],10),E=!0}if(8!==v)return{valid:!1,error_number:10,error:c}}return"3"==g[3][1]&&"w"==g[1]||"6"==g[3][1]&&"b"==g[1]?{valid:!1,error_number:11,error:p}:{valid:!0,error_number:0,error:r}}function v(){for(var e=0,n="",f=SQUARE_MAP.a8;f<=SQUARE_MAP.h1;f++){if(null==r[f])e++;else{e>0&&(n+=e,e=0);var u=r[f].color,s=r[f].type;n+=u===WHITE?s.toUpperCase():s.toLowerCase()}f+1&136&&(e>0&&(n+=e),f!==SQUARE_MAP.h1&&(n+="/"),e=0,f+=8)}var c="";o[WHITE]&BITS.KSIDE_CASTLE&&(c+="K"),o[WHITE]&BITS.QSIDE_CASTLE&&(c+="Q"),o[BLACK]&BITS.KSIDE_CASTLE&&(c+="k"),o[BLACK]&BITS.QSIDE_CASTLE&&(c+="q"),c=c||"-";var p=-1===i?"-":algebraic(i);return[n,t,c,p,a,l].join(" ")}function E(e){for(var r=0;r<e.length;r+=2)"string"==typeof e[r]&&"string"==typeof e[r+1]&&(u[e[r]]=e[r+1]);return u}function h(e){f.length>0||(e!==DEFAULT_POSITION?(u.SetUp="1",u.FEN=e):(delete u.SetUp,delete u.FEN))}function _(e){var n=r[SQUARE_MAP[e]];return n?{type:n.type,color:n.color}:null}function T(e,t){if(!("type"in e)||!("color"in e))return!1;if(-1===SYMBOLS.indexOf(e.type.toLowerCase()))return!1;if(!(t in SQUARE_MAP))return!1;var o=SQUARE_MAP[t];return(e.type!=KING||-1==n[e.color]||n[e.color]==o)&&(r[o]={type:e.type,color:e.color},e.type===KING&&(n[e.color]=o),h(v()),!0)}function d(e,r,n,o,i){var a={color:t,from:r,to:n,flags:o,piece:e[r].type};return i&&(a.flags|=BITS.PROMOTION,a.promotion=i),e[n]?a.captured=e[n].type:o&BITS.EP_CAPTURE&&(a.captured=PAWN),a}function I(e){function a(e,r,n,t,o){if(e[n].type!==PAWN||0!==rank(t)&&7!==rank(t))r.push(d(e,n,t,o));else for(var i=["q","r","b","n"],a=0,l=i.length;a<l;a++)r.push(d(e,n,t,o,i[a]))}var l=[],f=t,u=swap_color(f),s={b:1,w:6},c=SQUARE_MAP.a8,p=SQUARE_MAP.h1,g=!1,S=void 0===e||!("legal"in e)||e.legal,A=void 0===e||!("piece"in e)||"string"!=typeof e.piece||e.piece.toLowerCase();if(void 0!==e&&"square"in e){if(!(e.square in SQUARE_MAP))return[];c=p=SQUARE_MAP[e.square],g=!0}for(var v=c;v<=p;v++)if(136&v)v+=7;else{var E=r[v];if(null!=E&&E.color===f)if(E.type!==PAWN||!0!==A&&A!==PAWN){if(!0===A||A===E.type)for(var h=0,_=PIECE_OFFSETS[E.type].length;h<_;h++){var T=PIECE_OFFSETS[E.type][h];for(I=v;!(136&(I+=T));){if(null!=r[I]){if(r[I].color===f)break;a(r,l,v,I,BITS.CAPTURE);break}if(a(r,l,v,I,BITS.NORMAL),"n"===E.type||"k"===E.type)break}}}else{var I=v+PAWN_OFFSETS[f][0];if(null==r[I]){a(r,l,v,I,BITS.NORMAL);var I=v+PAWN_OFFSETS[f][1];s[f]===rank(v)&&null==r[I]&&a(r,l,v,I,BITS.BIG_PAWN)}for(h=2;h<4;h++){136&(I=v+PAWN_OFFSETS[f][h])||(null!=r[I]&&r[I].color===u?a(r,l,v,I,BITS.CAPTURE):I===i&&a(r,l,v,i,BITS.EP_CAPTURE))}}}if(!(!0!==A&&A!==KING||g&&p!==n[f])){if(o[f]&BITS.KSIDE_CASTLE){var m=(P=n[f])+2;null!=r[P+1]||null!=r[m]||b(u,n[f])||b(u,P+1)||b(u,m)||a(r,l,n[f],m,BITS.KSIDE_CASTLE)}if(o[f]&BITS.QSIDE_CASTLE){var P;m=(P=n[f])-2;null!=r[P-1]||null!=r[P-2]||null!=r[P-3]||b(u,n[f])||b(u,P-1)||b(u,m)||a(r,l,n[f],m,BITS.QSIDE_CASTLE)}}if(!S)return l;var C=[];for(v=0,_=l.length;v<_;v++)y(l[v]),R(f)||C.push(l[v]),w();return C}function m(e,r){var n="";if(e.flags&BITS.KSIDE_CASTLE)n="O-O";else if(e.flags&BITS.QSIDE_CASTLE)n="O-O-O";else{if(e.piece!==PAWN){var t=get_disambiguator(e,r);n+=e.piece.toUpperCase()+t}e.flags&(BITS.CAPTURE|BITS.EP_CAPTURE)&&(e.piece===PAWN&&(n+=algebraic(e.from)[0]),n+="x"),n+=algebraic(e.to),e.flags&BITS.PROMOTION&&(n+="="+e.promotion.toUpperCase())}return y(e),P()&&(C()?n+="#":n+="+"),w(),n}function b(e,n){for(var t=SQUARE_MAP.a8;t<=SQUARE_MAP.h1;t++)if(136&t)t+=7;else if(null!=r[t]&&r[t].color===e){var o=r[t],i=t-n,a=i+119;if(ATTACKS[a]&1<<SHIFTS[o.type]){if(o.type===PAWN){if(i>0){if(o.color===WHITE)return!0}else if(o.color===BLACK)return!0;continue}if("n"===o.type||"k"===o.type)return!0;for(var l=RAYS[a],f=t+l,u=!1;f!==n;){if(null!=r[f]){u=!0;break}f+=l}if(!u)return!0}}return!1}function R(e){return b(swap_color(e),n[e])}function P(){return R(t)}function C(){return P()&&0===I().length}function O(){return!P()&&0===I().length}function N(){for(var e={},n=[],t=0,o=0,i=SQUARE_MAP.a8;i<=SQUARE_MAP.h1;i++)if(o=(o+1)%2,136&i)i+=7;else{var a=r[i];a&&(e[a.type]=a.type in e?e[a.type]+1:1,"b"===a.type&&n.push(o),t++)}if(2===t)return!0;if(3===t&&(1===e.b||1===e.n))return!0;if(t===e.b+2){var l=0,f=n.length;for(i=0;i<f;i++)l+=n[i];if(0===l||l===f)return!0}return!1}function B(){for(var e=[],r={},n=!1;;){var t=w();if(!t)break;e.push(t)}for(;;){var o=v().split(" ").slice(0,4).join(" ");if(r[o]=o in r?r[o]+1:1,r[o]>=3&&(n=!0),!e.length)break;y(e.pop())}return n}function y(e){var u=t,s=swap_color(u);if(function(e){f.push({move:e,kings:{b:n.b,w:n.w},turn:t,castling:{b:o.b,w:o.w},ep_square:i,half_moves:a,move_number:l})}(e),r[e.to]=r[e.from],r[e.from]=null,e.flags&BITS.EP_CAPTURE&&(t===BLACK?r[e.to-16]=null:r[e.to+16]=null),e.flags&BITS.PROMOTION&&(r[e.to]={type:e.promotion,color:u}),r[e.to].type===KING){if(n[r[e.to].color]=e.to,e.flags&BITS.KSIDE_CASTLE){var c=e.to-1,p=e.to+1;r[c]=r[p],r[p]=null}else if(e.flags&BITS.QSIDE_CASTLE){c=e.to+1,p=e.to-2;r[c]=r[p],r[p]=null}o[u]=""}if(o[u])for(var g=0,S=ROOKS[u].length;g<S;g++)if(e.from===ROOKS[u][g].square&&o[u]&ROOKS[u][g].flag){o[u]^=ROOKS[u][g].flag;break}if(o[s])for(g=0,S=ROOKS[s].length;g<S;g++)if(e.to===ROOKS[s][g].square&&o[s]&ROOKS[s][g].flag){o[s]^=ROOKS[s][g].flag;break}i=e.flags&BITS.BIG_PAWN?"b"===t?e.to-16:e.to+16:-1,e.piece===PAWN||e.flags&(BITS.CAPTURE|BITS.EP_CAPTURE)?a=0:a++,t===BLACK&&l++,t=swap_color(t)}function w(){var e=f.pop();if(null==e)return null;var u=e.move;n=e.kings,t=e.turn,o=e.castling,i=e.ep_square,a=e.half_moves,l=e.move_number;var s,c,p=t,g=swap_color(t);if(r[u.from]=r[u.to],r[u.from].type=u.piece,r[u.to]=null,u.flags&BITS.CAPTURE)r[u.to]={type:u.captured,color:g};else if(u.flags&BITS.EP_CAPTURE){var S;S=p===BLACK?u.to-16:u.to+16,r[S]={type:PAWN,color:g}}u.flags&(BITS.KSIDE_CASTLE|BITS.QSIDE_CASTLE)&&(u.flags&BITS.KSIDE_CASTLE?(s=u.to+1,c=u.to-1):u.flags&BITS.QSIDE_CASTLE&&(s=u.to-2,c=u.to+1),r[s]=r[c],r[c]=null);return u}function K(e,r){for(var n=stripped_san(e),t=0;t<2;t++){if(1==t){if(!r)return null;var o=!1;if(u=n.match(/([pnbrqkPNBRQK])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBN])?/)){var i=u[1],a=u[2],l=u[3],f=u[4];1==a.length&&(o=!0)}else{var u;if(u=n.match(/([pnbrqkPNBRQK])?([a-h]?[1-8]?)x?-?([a-h][1-8])([qrbnQRBN])?/)){i=u[1],a=u[2],l=u[3],f=u[4];if(1==a.length)o=!0}}}for(var s=infer_piece_type(n),c=I({legal:!0,piece:i||s}),p=0,g=c.length;p<g;p++)switch(t){case 0:if(n===stripped_san(m(c[p],c)))return c[p];break;case 1:if(u){if(!(i&&i.toLowerCase()!=c[p].piece||SQUARE_MAP[a]!=c[p].from||SQUARE_MAP[l]!=c[p].to||f&&f.toLowerCase()!=c[p].promotion))return c[p];if(o){var S=algebraic(c[p].from);if(!(i&&i.toLowerCase()!=c[p].piece||SQUARE_MAP[l]!=c[p].to||a!=S[0]&&a!=S[1]||f&&f.toLowerCase()!=c[p].promotion))return c[p]}}}}return null}function L(e){var r=clone(e);r.san=m(r,I({legal:!0})),r.to=algebraic(r.to),r.from=algebraic(r.from);var n="";for(var t in BITS)BITS[t]&r.flags&&(n+=FLAGS[t]);return r.flags=n,r}function U(e){for(var r=I({legal:!1}),n=0,o=t,i=0,a=r.length;i<a;i++){if(y(r[i]),!R(o))if(e-1>0)n+=U(e-1);else n++;w()}return n}return S(void 0===e?DEFAULT_POSITION:e),{load:function(e){return S(e)},reset:function(){return g()},moves:function(e){for(var r=I(e),n=[],t=0,o=r.length;t<o;t++)void 0!==e&&"verbose"in e&&e.verbose?n.push(L(r[t])):n.push(m(r[t],I({legal:!0})));return n},in_check:function(){return P()},in_checkmate:function(){return C()},in_stalemate:function(){return O()},in_draw:function(){return a>=100||O()||N()||B()},insufficient_material:function(){return N()},in_threefold_repetition:function(){return B()},game_over:function(){return a>=100||C()||O()||N()||B()},validate_fen:function(e){return A(e)},fen:function(){return v()},board:function(){for(var e=[],n=[],t=SQUARE_MAP.a8;t<=SQUARE_MAP.h1;t++)null==r[t]?n.push(null):n.push({square:algebraic(t),type:r[t].type,color:r[t].color}),t+1&136&&(e.push(n),n=[],t+=8);return e},pgn:function(e){var r="object"==typeof e&&"string"==typeof e.newline_char?e.newline_char:"\n",n="object"==typeof e&&"number"==typeof e.max_width?e.max_width:0,t=[],o=!1;for(var i in u)t.push("["+i+' "'+u[i]+'"]'+r),o=!0;o&&f.length&&t.push(r);for(var a=function(e){var r=s[v()];void 0!==r&&(e=`${e}${e.length>0?" ":""}{${r}}`);return e},c=[];f.length>0;)c.push(w());var p=[],g="";for(0===c.length&&p.push(a(""));c.length>0;){g=a(g);var S=c.pop();if(f.length||"b"!==S.color)"w"===S.color&&(g.length&&p.push(g),g=l+".");else{const e=`${l}. ...`;g=g?`${g} ${e}`:e}g=g+" "+m(S,I({legal:!0})),y(S)}if(g.length&&p.push(a(g)),void 0!==u.Result&&p.push(u.Result),0===n)return t.join("")+p.join(" ");var A=function(){return t.length>0&&" "===t[t.length-1]&&(t.pop(),!0)},E=function(e,o){for(var i of o.split(" "))if(i){if(e+i.length>n){for(;A();)e--;t.push(r),e=0}t.push(i),e+=i.length,t.push(" "),e++}return A()&&e--,e},h=0;for(i=0;i<p.length;i++)h+p[i].length>n&&p[i].includes("{")?h=E(h,p[i]):(h+p[i].length>n&&0!==i?(" "===t[t.length-1]&&t.pop(),t.push(r),h=0):0!==i&&(t.push(" "),h++),t.push(p[i]),h+=p[i].length);return t.join("")},load_pgn:function(e,r){var n=void 0!==r&&"sloppy"in r&&r.sloppy;function t(e){return e.replace(/\\/g,"\\")}e=e.trim();var o="object"==typeof r&&"string"==typeof r.newline_char?r.newline_char:"\r?\n",i=new RegExp("^(\\[((?:"+t(o)+")|.)*\\])(?:\\s*"+t(o)+"){2}"),a=i.test(e)?i.exec(e)[1]:"";g();var l=function(e,r){for(var n="object"==typeof r&&"string"==typeof r.newline_char?r.newline_char:"\r?\n",o={},i=e.split(new RegExp(t(n))),a="",l="",f=0;f<i.length;f++){var u=/^\s*\[([A-Za-z]+)\s*"(.*)"\s*\]\s*$/;a=i[f].replace(u,"$1"),l=i[f].replace(u,"$2"),trim(a).length>0&&(o[a]=l)}return o}(a,r),f="";for(var c in l)"fen"===c.toLowerCase()&&(f=l[c]),E([c,l[c]]);if(n){if(f&&!S(f,!0))return!1}else if(!("1"!==l.SetUp||"FEN"in l&&S(l.FEN,!0)))return!1;for(var p=function(e){return`{${function(e){return Array.from(e).map((function(e){return e.charCodeAt(0)<128?e.charCodeAt(0).toString(16):encodeURIComponent(e).replace(/\%/g,"").toLowerCase()})).join("")}((e=e.replace(new RegExp(t(o),"g")," ")).slice(1,e.length-1))}}`},A=function(e){if(e.startsWith("{")&&e.endsWith("}"))return function(e){return 0==e.length?"":decodeURIComponent("%"+e.match(/.{1,2}/g).join("%"))}(e.slice(1,e.length-1))},h=e.replace(a,"").replace(new RegExp(`({[^}]*})+?|;([^${t(o)}]*)`,"g"),(function(e,r,n){return void 0!==r?p(r):" "+p(`{${n.slice(1)}}`)})).replace(new RegExp(t(o),"g")," "),_=/(\([^\(\)]+\))+?/g;_.test(h);)h=h.replace(_,"");var T=trim(h=(h=(h=h.replace(/\d+\.(\.\.)?/g,"")).replace(/\.\.\./g,"")).replace(/\$\d+/g,"")).split(new RegExp(/\s+/));T=T.join(",").replace(/,,+/g,",").split(",");for(var d="",I="",m=0;m<T.length;m++){var b=A(T[m]);if(void 0===b)if(null==(d=K(T[m],n))){if(!(TERMINATION_MARKERS.indexOf(T[m])>-1))return!1;I=T[m]}else I="",y(d);else s[v()]=b}return I&&Object.keys(u).length&&!u.Result&&E(["Result",I]),!0},header:function(){return E(arguments)},turn:function(){return t},move:function(e,r){var n=void 0!==r&&"sloppy"in r&&r.sloppy,t=null;if("string"==typeof e)t=K(e,n);else if("object"==typeof e)for(var o=I(),i=0,a=o.length;i<a;i++)if(e.from===algebraic(o[i].from)&&e.to===algebraic(o[i].to)&&(!("promotion"in o[i])||e.promotion===o[i].promotion)){t=o[i];break}if(!t)return null;var l=L(t);return y(t),l},undo:function(){var e=w();return e?L(e):null},clear:function(){return c()},put:function(e,r){return T(e,r)},get:function(e){return _(e)},ascii(){for(var e="   +------------------------+\n",n=SQUARE_MAP.a8;n<=SQUARE_MAP.h1;n++){if(0===file(n)&&(e+=" "+"87654321"[rank(n)]+" |"),null==r[n])e+=" . ";else{var t=r[n].type;e+=" "+(r[n].color===WHITE?t.toUpperCase():t.toLowerCase())+" "}n+1&136&&(e+="|\n",n+=8)}return e+="   +------------------------+\n",e+="     a  b  c  d  e  f  g  h"},remove:function(e){return function(e){var t=_(e);return r[SQUARE_MAP[e]]=null,t&&t.type===KING&&(n[t.color]=-1),h(v()),t}(e)},perft:function(e){return U(e)},square_color:function(e){if(e in SQUARE_MAP){var r=SQUARE_MAP[e];return(rank(r)+file(r))%2==0?"light":"dark"}return null},history:function(e){for(var r=[],n=[],t=(void 0!==e&&"verbose"in e&&e.verbose);f.length>0;)r.push(w());for(;r.length>0;){var o=r.pop();t?n.push(L(o)):n.push(m(o,I({legal:!0}))),y(o)}return n},get_comment:function(){return s[v()]},set_comment:function(e){s[v()]=e.replace("{","[").replace("}","]")},delete_comment:function(){var e=s[v()];return delete s[v()],e},get_comments:function(){return p(),Object.keys(s).map((function(e){return{fen:e,comment:s[e]}}))},delete_comments:function(){return p(),Object.keys(s).map((function(e){var r=s[e];return delete s[e],{fen:e,comment:r}}))}}};try{console.log("Chessboard.js version:",Chessboard.version);var board=null,game=new Chess,$status=$("#status"),$fen=$("#fen"),$pgn=$("#pgn");function onDragStart(e,r,n,t){return console.log("onDragStart called"),!game.game_over()&&(!("w"===game.turn()&&-1!==r.search(/^b/)||"b"===game.turn()&&-1!==r.search(/^w/))&&void 0)}function onDrop(e,r){console.log("onDrop called"),alert("This never shows?");var n=game.move({from:e,to:r,promotion:"q"});if(alert("This never shows?"),null===n)return"snapback";board.position(game.fen()),console.log("This never shows?"),$.get("/ai-move",{fen:game.fen()},(function(e){null!==game.move(e)?(board.position(game.fen()),updateStatus()):console.error("Received invalid move from server:",e)}))}function onSnapEnd(){console.log("onSnapEnd called"),board.position(game.fen())}function updateStatus(){var e="",r="White";"b"===game.turn()&&(r="Black"),game.in_checkmate()?e="Game over, "+r+" is in checkmate.":game.in_draw()?e="Game over, drawn position":(e=r+" to move",game.in_check()&&(e+=", "+r+" is in check")),$status.html(e),$fen.html(game.fen()),$pgn.html(game.pgn())}var config={draggable:!0,position:"start",onDragStart:onDragStart,onDrop:onDrop,onSnapEnd:onSnapEnd};board=Chessboard("myBoard",config),updateStatus()}catch(e){console.log(e)}